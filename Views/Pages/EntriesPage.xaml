<Page
    x:Class="PWSW_CalBalanceAndConsumptionStats.Views.Pages.EntriesPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:models="using:PWSW_CalBalanceAndConsumptionStats.Models"
    xmlns:converters="using:PWSW_CalBalanceAndConsumptionStats.Converters">

	<Page.Resources>
		<converters:CalorieColorConverter x:Key="CalorieColorConverter"/>
		<converters:TypeToIconConverter x:Key="TypeToIconConverter"/>
		<converters:StringFormatConverter x:Key="StringFormatConverter"/>
		<converters:CollectionVisibilityConverter x:Key="ListVisibilityConverter" Invert="False"/>
		<converters:CollectionVisibilityConverter x:Key="PlaceholderVisibilityConverter" Invert="True"/>
	</Page.Resources>

	<Grid Padding="40">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
		</Grid.RowDefinitions>

		<Grid Grid.Row="0" Margin="0,0,0,20">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="*"/>
				<ColumnDefinition Width="Auto"/>
			</Grid.ColumnDefinitions>

			<StackPanel Orientation="Horizontal" Spacing="15">
				<Button Command="{x:Bind ViewModel.GoBackCommand}" 
                        Content="&#xE72B;" 
                        FontFamily="Segoe MDL2 Assets" 
                        Width="40" Height="40"
                        ToolTipService.ToolTip="Powrót do menu"/>
				<TextBlock Text="Historia aktywności i posiłków" FontSize="28" FontWeight="Bold" VerticalAlignment="Center"/>
			</StackPanel>

			<Button Grid.Column="1" 
                    Command="{x:Bind ViewModel.GoToAddEntryCommand}"
                    Style="{StaticResource AccentButtonStyle}"
                    Padding="15,0,15,0" Height="40">
				<StackPanel Orientation="Horizontal" Spacing="8">
					<FontIcon Glyph="&#xE109;" FontFamily="Segoe MDL2 Assets" FontSize="16"/>
					<TextBlock Text="Dodaj wpis"/>
				</StackPanel>
			</Button>
		</Grid>

		<StackPanel Grid.Row="1" Orientation="Horizontal" Spacing="10" Margin="0,0,0,20">
			<CalendarDatePicker Date="{x:Bind ViewModel.SelectedDateFilter, Mode=TwoWay}" 
                                PlaceholderText="Filtruj datę" Width="180"/>

			<ComboBox SelectedIndex="{x:Bind ViewModel.SelectedTypeIndex, Mode=TwoWay}" Width="150">
				<ComboBoxItem Content="Wszystko"/>
				<ComboBoxItem Content="Posiłki"/>
				<ComboBoxItem Content="Aktywność"/>
			</ComboBox>

			<Button Content="Filtruj" 
                    Command="{x:Bind ViewModel.ApplyFiltersCommand}" 
                    Style="{StaticResource AccentButtonStyle}"/>

			<Button Content="Reset" 
                    Command="{x:Bind ViewModel.ResetFiltersCommand}"/>
		</StackPanel>

		<ListView Grid.Row="2" 
                ItemsSource="{x:Bind ViewModel.FilteredEntries, Mode=OneWay}" 
                SelectionMode="None"
                Visibility="{x:Bind ViewModel.HasEntries, Mode=OneWay, Converter={StaticResource ListVisibilityConverter}}">
			<ListView.ItemTemplate>
				<DataTemplate x:DataType="models:Entry">
					<Grid Padding="12" BorderThickness="0,0,0,1" BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}">
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="60"/>
							<ColumnDefinition Width="*"/>
							<ColumnDefinition Width="120"/>
							<ColumnDefinition Width="40"/>
						</Grid.ColumnDefinitions>

						<TextBlock Text="{x:Bind DateTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='HH:mm'}" 
                                   VerticalAlignment="Center" Foreground="Gray"/>

						<StackPanel Grid.Column="1" VerticalAlignment="Center">
							<TextBlock Text="{x:Bind Name}" FontWeight="SemiBold" FontSize="16"/>
							<TextBlock Text="{x:Bind DateTime, Converter={StaticResource StringFormatConverter}, ConverterParameter='dd.MM.yyyy'}" 
                                       FontSize="12" Foreground="Gray"/>
						</StackPanel>

						<StackPanel Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Right">
							<TextBlock Text="{x:Bind Calories, Converter={StaticResource StringFormatConverter}, ConverterParameter='F1'}" 
                                       Foreground="{x:Bind Type, Converter={StaticResource CalorieColorConverter}}"
                                       FontWeight="Bold" FontSize="18"/>
							<TextBlock Text="kcal" FontSize="10" HorizontalAlignment="Right" Foreground="Gray"/>
						</StackPanel>

						<FontIcon Grid.Column="3" Glyph="{x:Bind Type, Converter={StaticResource TypeToIconConverter}}" 
                                  FontFamily="Segoe MDL2 Assets" FontSize="18" Foreground="Gray" Margin="10,0,0,0"/>
					</Grid>
				</DataTemplate>
			</ListView.ItemTemplate>
		</ListView>

		<StackPanel Grid.Row="2" 
                    VerticalAlignment="Center" 
                    HorizontalAlignment="Center"
                    Visibility="{x:Bind ViewModel.HasEntries, Mode=OneWay, Converter={StaticResource PlaceholderVisibilityConverter}}">
			<FontIcon Glyph="&#xE9CE;" FontSize="48" Foreground="LightGray" FontFamily="Segoe MDL2 Assets"/>
			<TextBlock Text="Brak wpisów dla wybranych filtrów" 
                    Foreground="Gray" Margin="0,10,0,0"/>
		</StackPanel>
	</Grid>
</Page>